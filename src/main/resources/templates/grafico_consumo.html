<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gr√°fico de Consumo </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ServiApp</title>
        
        <!--Parte Header compartida desde aqui....-->
        <link rel="shortcut icon" href="/img_local/logo-pagina-serviapp.png" />
    
        <!--links CSS-->
        <link rel="stylesheet" href="/estilos_interfaz-usuario/barra_perfil.css"> <!-- Barra lateral reutilizable -->
        <link rel="stylesheet" href="/estilos_interfaz-usuario/style_gest_ser.css"> <!-- CSS de la p√°gina Inicio -->
        <link rel="stylesheet" href="/main.css">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
        <!--BOXICOINS Y BOOTSTRAP-->
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    
        <!--Fuente Kanit-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    
    
    
    <body>
        <header>
            <div class="contenedor-principal" id="header1">
                <h1 id="h1001">ServiApp</h1>
            </div>
            
            <div class="profile-menu">
                <button class="profile-button" id="profileButton">
                    <img src="https://img.freepik.com/vector-premium/icono-perfil-usuario-estilo-plano-ilustracion-vector-avatar-miembro-sobre-fondo-aislado-concepto-negocio-signo-permiso-humano_157943-15752.jpg" alt="Avatar" class="profile-avatar">
                </button>
                <div class="profile-dropdown" id="profileDropdown">
                    <a href="datos-personales">Configuraci√≥n</a>
                    <a href="/logout">Cerrar Sesion</a>
                    
                </div>
            </div>
        </header>
    
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="p-2 g-col-6"><a href="interfaz_inicio"><i class='bx bx-home'></i> Inicio</a></li>
                    <li class="p-2 g-col-6"><a href="registrar-servicio"><i class='bx bx-task' ></i> Registrar Servicio</a></li>
                    <li class="p-2 g-col-6"><a href="gestionar-servicio"><i class='bx bx-line-chart'></i> Gestionar Servicio</a></li>
                    <li class="p-2 g-col-6"><a href="consejos-personzalidos"><i class='bx bx-bulb'></i> Consejos de Ahorro Personalizados </a></li>
                    <li class="p-2 g-col-6"><a href="cortes"><i class='bx bxs-alarm'></i> Cortes</a></li>
                    <li class="p-2 g-col-6"><a href="lineas-atencion"><i class='bx bx-phone'></i> Lineas de Atencion</a></li>
                </ul>
              </div>
            </div>
          </nav>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <style>
        body {
            background-color: #f4f8fb;
            font-family: 'Segoe UI', sans-serif;
        }

        h5.card-title {
            font-weight: bold;
        }

        #graficoContainer {
            height: 400px;
        }

        .btn-servicio {
            border-radius: 2rem;
            padding: 0.5rem 1.5rem;
            font-weight: 600;
            transition: 0.3s;
            border: 2px solid transparent;
        }

        .btn-servicio.active {
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.15);
            transform: scale(1.03);
        }

        .btn-agua {
            background-color: #0d6efd;
            color: white;
        }

        .btn-energia {
            background-color: #ffc107;
            color: black;
        }

        .btn-gas {
            background-color: #dc3545;
            color: white;
        }

        .btn-agua:hover {
            background-color: #0b5ed7;
        }

        .btn-energia:hover {
            background-color: #e0a800;
        }

        .btn-gas:hover {
            background-color: #c82333;
        }

        #filtroOrden {
            border-radius: 2rem;
            font-weight: 600;
            padding: 0.5rem 1.5rem;
        }

        .card.shadow {
            border-radius: 1.25rem;
        }

        #cardPromedio {
            border-radius: 1.25rem;
        }
    </style>
</head>
<body>


<div class="container mt-5">

    <!-- Tarjeta con el promedio de consumo del hogar -->
    <div class="mb-4">
        <div id="cardPromedio" class="card text-white shadow">
            <div class="card-body text-center">
                <h5 class="card-title">Promedio mensual de consumo del hogar</h5>
                <p class="card-text display-6" id="promedioValor">--</p>
            </div>
        </div>
    </div>

    <!-- Botones para seleccionar tipo de servicio -->
    <div class="mb-3 d-flex justify-content-between flex-wrap gap-2">
        <div class="d-flex gap-2">
            <button class="btn btn-servicio btn-agua active" onclick="cargarGrafico('agua', ordenSeleccionado)">üíß Agua</button>
            <button class="btn btn-servicio btn-energia" onclick="cargarGrafico('energ√≠a', ordenSeleccionado)">‚ö° Energ√≠a</button>
            <button class="btn btn-servicio btn-gas" onclick="cargarGrafico('gas', ordenSeleccionado)">üî• Gas</button>
        </div>
        <button id="filtroOrden" class="btn btn-outline-dark" onclick="cambiarOrden()">
            <i class="fas fa-sort-amount-up"></i> Orden
        </button>
    </div>

    <!-- Contenedor del gr√°fico -->
    <div class="card shadow">
        <div class="card-body">
            <div id="graficoContainer">
                <canvas id="graficoConsumoPorHabitante"></canvas>
            </div>
        </div>
    </div>

</div>

<script>
    let ordenSeleccionado = 'asc';

    function cambiarOrden() {
        ordenSeleccionado = ordenSeleccionado === 'asc' ? 'desc' : 'asc';
        const tipo = document.querySelector('.btn-servicio.active')?.innerText.toLowerCase().replace('üíß ', '').replace('‚ö° ', '').replace('üî• ', '') || 'agua';
        cargarGrafico(tipo, ordenSeleccionado);

        const iconoOrden = document.querySelector('#filtroOrden i');
        iconoOrden.classList.toggle('fa-sort-amount-up');
        iconoOrden.classList.toggle('fa-sort-amount-down');
    }

    function cargarGrafico(tipoServicio, orden) {
        document.querySelectorAll('.btn-servicio').forEach(btn => btn.classList.remove('active'));
        const selectedBtn = Array.from(document.querySelectorAll('.btn-servicio')).find(btn =>
            btn.innerText.toLowerCase().includes(tipoServicio)
        );
        if (selectedBtn) selectedBtn.classList.add('active');

        fetch(`/api/consumos/${tipoServicio}/${orden}`)
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('graficoConsumoPorHabitante').getContext('2d');

                if (window.graficoConsumo) {
                    window.graficoConsumo.destroy();
                }

                const colores = data.consumosTotales.map(consumo =>
                    consumo <= data.promedioPorHogar
                        ? 'rgba(34, 172, 26, 0.89)'
                        : 'rgba(255, 99, 132, 0.7)'
                );

                window.graficoConsumo = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.labels,
                        datasets: [
                            {
                                label: `Consumo mensual del hogar (${tipoServicio})`,
                                data: data.consumosTotales,
                                backgroundColor: colores,
                                borderColor: colores.map(c => c.replace('0.7', '1')),
                                borderWidth: 1
                            },
                            {
                                type: 'line',
                                label: 'Promedio estimado por hogar',
                                data: Array(data.consumosTotales.length).fill(data.promedioPorHogar),
                                borderColor: 'rgba(54, 162, 235, 0.8)',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Consumo total del hogar'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const index = context.dataIndex;
                                        const porHabitante = data.consumosPorHabitante[index];
                                        return [
                                            `${context.dataset.label}: ${context.raw.toFixed(2)}`,
                                            `Consumo por habitante: ${porHabitante.toFixed(2)}`
                                        ];
                                    }
                                }
                            }
                        }
                    }
                });

                document.getElementById('promedioValor').textContent = data.promedioConsumoHogar.toFixed(2);
                const card = document.getElementById('cardPromedio');
                card.classList.remove('bg-success', 'bg-danger');
                card.classList.add(
                    data.promedioConsumoHogar <= data.promedioPorHogar ? 'bg-success' : 'bg-danger'
                );
            });
    }

    window.onload = () => cargarGrafico('agua', 'asc');
</script>

</body>
</html>
 <!-- Pie de p√°gina -->
 <footer>
    <div class="contenido-pie-pagina">
        <img src="/img_local/logo-pagina-serviapp.png" alt="Logo" class="footer-logo">
        <span>¬© 2024 ServiApp / todos los derechos reservados</span>
        <ul class="enlaces-pie-pagina">
            <li><a href="#" id="openModal-privacidad">Privacidad</a></li>
         
        </ul>
    </div>
    <div class="nota-pie-pagina">
        <a href="">No compartir informaci√≥n</a>
    </div>
</footer>

    <!-- ventana privacidasd -->
    <div id="termsModal-privacidad" class="modal-privacidad">
        <div class="modal-content-privacidad">
            <span class="cerrar-privacidad">&times;</span>
            <h2>PRIVACIDAD</h2>
                <p>
            En ServiApp somos conscientes de la importancia de la privacidad y protecci√≥n de los datos personales de nuestros usuarios. Por esta raz√≥n, nuestro deber con la seguridad de la informaci√≥n de nuestros usuarios est√° fundamentado en este marco legal que respalda todos nuestros procesos.<br><br>
            
            Las normas internacionales ofrecen un marco general para el tratamiento adecuado de la informaci√≥n de los usuarios. Aunque estas normativas no siempre tienen aplicaci√≥n directa en Colombia, representan normativas que en ServiApp tratamos de cumplir para proteger la privacidad de nuestros usuarios. El convenio 108 del Consejo de Europa, por ejemplo, es una referencia clave que establece principios b√°sicos sobre la protecci√≥n de los datos personales frente a su tratamiento automatizado. El Reglamento General de Protecci√≥n de Datos (GDPR) de la Uni√≥n Europea es un referente mundial en t√©rminos de la protecci√≥n de la privacidad y, a pesar de que est√° dirigido a ciudadanos europeos, se puede considerar un modelo a seguir. De igual forma, los principios de los Derechos Humanos de las Naciones Unidas establecen la importancia de respetar la privacidad como un derecho humano.<br><br>
            
            En Colombia, el marco legal se consolida a partir de la Constituci√≥n Pol√≠tica Nacional, en la cual el art√≠culo 15 nos expone sobre el derecho a la intimidad y protecci√≥n de datos personales. En ServiApp, nos aseguramos de que nuestros usuarios puedan ejercer este derecho, permiti√©ndoles acceder y actualizar su informaci√≥n almacenada en nuestra base de datos cuando lo requieran. Tambi√©n nos basamos en el art√≠culo 20, el cual protege el derecho a recibir informaci√≥n clara y veraz. Para nosotros, esto significa que todo lo relacionado con el tratamiento de datos ser√° siempre transparente y comprensible.<br><br>
            
            La Ley 1581 de 2012, conocida como la Ley de Protecci√≥n de Datos Personales, es la ley central de nuestra operaci√≥n en Colombia. Esta ley establece los principios y procedimientos que debemos seguir al manejar los datos de nuestros usuarios, asegurando su privacidad y estableciendo obligaciones claras para nosotros como responsables de esa informaci√≥n. De igual forma, seguiremos la Ley 1266 de 2008, que regula espec√≠ficamente el manejo de informaci√≥n financiera y crediticia, y la Ley 1273 de 2009, que tipifica los delitos inform√°ticos y define las sanciones aplicables para quienes accedan sin autorizaci√≥n a sistemas inform√°ticos, algo esencial para la seguridad de los datos que manejaremos en nuestra plataforma.<br><br>
            
            Adem√°s de estas leyes, ServiApp sigue las regulaciones emitidas a trav√©s de decretos. Por ejemplo, el Decreto 1377 de 2013 es importante, pues nos explica c√≥mo debemos obtener el consentimiento de nuestros usuarios para poder recolectar y usar sus datos. En cada registro debemos asegurarnos de que los usuarios tengan claro para qu√© fines se usar√° su informaci√≥n. Por otro lado, el Decreto 886 de 2014, que aborda temas de ciberseguridad, nos ayuda a implementar medidas de protecci√≥n adecuadas para evitar riesgos de seguridad.<br><br>
            
            Para las regulaciones a nivel local en la ciudad de Cartagena, cumplimos con los acuerdos municipales y ordenanzas locales que pueden influir en la manera en que gestionamos los servicios p√∫blicos y la informaci√≥n asociada.<br><br>
            
            El C√≥digo Penal Colombiano tambi√©n es importante, ya que establece sanciones para quienes cometan delitos inform√°ticos, como la violaci√≥n de la privacidad o el uso indebido de los datos personales. En ServiApp seguimos estos lineamientos para prevenir cualquier incidente que pudiera comprometer la seguridad de la informaci√≥n.<br><br>
            
            Finalmente, aplicamos lo que establecen las resoluciones y circulares emitidas por organismos de control. La Resoluci√≥n 002 de 2021 de la Superintendencia de Industria y Comercio (SIC) nos ofrece gu√≠as claras sobre c√≥mo gestionar los datos personales en nuestro contexto tecnol√≥gico, mientras que la Circular Externa 005 de 2017 nos orienta sobre c√≥mo manejar la informaci√≥n en sistemas digitales, garantizando que estemos al d√≠a con las mejores pr√°cticas.
                </p>
        </div>
    </div> 


<script src="/javascripts/barra_perfil.js"></script>
<script src="/javascripts/ventana_privacidad.js"></script> 

<script>