<!DOCTYPE html>
<html lang="en">
    <html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiApp</title>


     <!--Parte Header compartida desde aqui....-->
     <link rel="shortcut icon" href="/img_local/logo-pagina-serviapp.png" />

     <!--links CSS-->
     <link rel="stylesheet" href="/estilos_interfaz-usuario/barra_perfil.css"> <!-- Barra lateral reutilizable -->
     <link rel="stylesheet" href="/estilos_interfaz-usuario/style_perfil.css"> <!-- CSS de la p√°gina Inicio -->
     <link rel="stylesheet" href="/main.css">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">

 
     <!--BOXICOINS Y BOOTSTRAP-->
     <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 
 
     <!--Fuente Kanit-->
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
     <!-- SweetAlert2 CDN -->
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>
    <header>
        <div class="contenedor-principal" id="header1">
            <h1 id="h1001">ServiApp</h1>
        </div>
        <div class="profile-menu">
            <button class="profile-button" id="profileButton">
                <img src="https://img.freepik.com/vector-premium/icono-perfil-usuario-estilo-plano-ilustracion-vector-avatar-miembro-sobre-fondo-aislado-concepto-negocio-signo-permiso-humano_157943-15752.jpg" alt="Avatar" class="profile-avatar">
            </button>
            <div class="profile-dropdown" id="profileDropdown">
                <a href="datos-personales">Configuraci√≥n</a>
                <a href="/logout">Cerrar Sesion</a>
            </div>
        </div>
    </header>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="p-2 g-col-6"><a href="interfaz_inicio"><i class='bx bx-home'></i> Inicio</a></li>
                <li class="p-2 g-col-6"><a href="registrar-servicio"><i class='bx bx-task' ></i> Registrar Servicio</a></li>
                <li class="p-2 g-col-6"><a href="gestionar-servicio"><i class='bx bx-line-chart'></i> Gestionar Servicio</a></li>
                <li class="p-2 g-col-6"><a href="consejos-personzalidos"><i class='bx bx-bulb'></i> Consejos de Ahorro Personalizados </a></li>
                <li class="p-2 g-col-6"><a href="cortes"><i class='bx bxs-alarm'></i> Cortes</a></li>
                <li class="p-2 g-col-6"><a href="lineas-atencion"><i class='bx bx-phone'></i> Lineas de Atencion</a></li>
            </ul>
          </div>
        </div>
      </nav>
   
      
        <!-- Contenido de configuraci√≥n -->
    <div class="container mt-5">
        <div class="row">
            <!-- Men√∫ lateral -->
            <div class="col-md-3">
                <div class="list-group">
                <a th:href="@{/datos-personales}" class="list-group-item list-group-item-action" th:classappend="${section == 'datos-personales'} ? 'active'">Datos Personales</a>
                <a th:href="@{/cambiar-contrasena}" class="list-group-item list-group-item-action" th:classappend="${section == 'cambiar-contrasena'} ? 'active'">Cambiar Contrase√±a</a>
                <a th:href="@{/mis-servicios}" class="list-group-item list-group-item-action" th:classappend="${section == 'mis-servicios'} ? 'active'">Mis Servicios</a>
                <a th:href="@{/mis-consumos}" class="list-group-item list-group-item-action" th:classappend="${section == 'mis-consumos'} ? 'active'">Mis Consumos</a>
                <!-- Nueva opci√≥n de men√∫ para gestionar predio -->
                <a th:href="@{/mi-predio}" class="list-group-item list-group-item-action" th:classappend="${section == 'mi-predio'} ? 'active'">Mi Predio</a>
                </div>
            </div>


            <div class="col-md-9">
           <!-- Datos Personales -->
           <section th:if="${section == 'datos-personales'}">
            <h4>Datos Personales</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Nombre Completo</th>
                        <th>Correo Electr√≥nico</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td th:text="${usuario.nombre}">Nombre Completo</td>
                        <td colspan="2" th:if="${editarUsuarioId == usuario.id}">
                            <form th:action="@{/usuarios/actualizar/{id}(id=${usuario.id})}" th:object="${usuario}" method="post" id="form-datos-personales">
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" name="email" th:value="${usuario.email}" required style="flex: 1;">
                                    <button type="button" class="btn btn-success" onclick="confirmarCambioDatos(event)">Guardar Cambios</button>
                                    <a th:href="@{/datos-personales}" class="btn btn-danger">Cancelar</a>
                                </div>
                            </form>
                            
                        </td>
                        <td th:if="${editarUsuarioId != usuario.id}" th:text="${usuario.email}">Correo Electr√≥nico</td>
                        <td th:if="${editarUsuarioId != usuario.id}">
                            <a th:href="@{/usuarios/editar/{id}(id=${usuario.id})}" class="btn btn-success">Actualizar</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>

                <!-- Cambiar Contrase√±a -->
            <section th:if="${section == 'cambiar-contrasena'}" class="seccion_cambiar_password">
                <h4>Cambiar Contrase√±a</h4>
            
                <!-- Mensajes de error o √©xito -->
                <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
                <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
            
                <form th:action="@{/usuarios/cambiar-contrasena}" method="post" id="changePasswordForm" onsubmit="confirmarCambioContrase√±a(event)"
>
                    <div class="mb-3">
                        <label for="current-password" class="form-label">Contrase√±a Actual</label>
                        <div class="input-group">
                            <input type="password" class="form-control" name="currentPassword" id="current-password" required>
                            <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility('current-password')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="new-password" class="form-label">Nueva Contrase√±a</label>
                        <div class="input-group">
                            <input type="password" class="form-control" name="newPassword" id="new-password" required 
                            pattern="^(?=.*[0-9])(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$"
                            title="La contrase√±a debe tener al menos 8 caracteres, incluir al menos un n√∫mero y un car√°cter especial." >
                            <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility('new-password')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="confirm-password" class="form-label">Confirmar Contrase√±a</label>
                        <div class="input-group">
                            <input type="password" class="form-control" name="confirmPassword" id="confirm-password" required>
                            <button type="button" class="btn btn-outline-secondary" onclick="togglePasswordVisibility('confirm-password')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="boton-cambiar-password">Cambiar Contrase√±a</button>

                </form>
            </section>
                
          
                <!-- Mis Servicios -->
                <section th:if="${section == 'mis-servicios'}">
    <h4>Mis Servicios</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Tipo de Servicio</th>
                <th>P√≥liza</th>
                <th>N√∫mero de Habitantes</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="servicio : ${servicios}">
                <td th:text="${servicio.tipo_servicio}">Tipo de Servicio</td>
                
                <td colspan="3" th:if="${editarServicioId == servicio.id}">
                    <form th:action="@{/servicios/actualizar/{id}(id=${servicio.id})}" th:object="${servicio}" method="post" id="form-servicios">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" name="poliza" th:value="${servicio.poliza}" required style="flex: 1;">
                            <input type="number" name="habitantes" th:value="${servicio.habitantes}" required style="flex: 1;">
                            <button type="button" class="btn btn-success" onclick="confirmarCambioServicio(event)">Guardar Cambios</button>
                            <a th:href="@{/mis-servicios}" class="btn btn-danger">Cancelar</a>
                        </div>
                    </form>
                    
                </td>
                
                <td th:if="${editarServicioId != servicio.id}" th:text="${servicio.poliza}">P√≥liza</td>
                <td th:if="${editarServicioId != servicio.id}" th:text="${servicio.habitantes}">N√∫mero de Habitantes</td>
                
                <td th:if="${editarServicioId != servicio.id}">
                    <a th:href="@{/servicios/editar/{id}(id=${servicio.id})}" class="btn btn-primary">Actualizar</a>
                    <form th:action="@{/servicios/eliminar/{id}(id=${servicio.id})}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
</section>

<!-- Mis Consumos -->
<section th:if="${section == 'mis-consumos'}">
    <h4>Historial de Consumos</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Servicio</th>
                <th>Mes</th>
                <th>A√±o</th>
                <th>Consumo</th>
                <th>Unidad</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="periodo : ${periodos}">
                <td th:text="${periodo.servicio.tipo_servicio}">Tipo de Servicio</td>
                
                <!-- Formulario de edici√≥n -->
                <td colspan="4" th:if="${editarConsumoId == periodo.id}">
                    <form th:action="@{/actualizar-consumo/{id}(id=${periodo.id})}" method="post" id="form-consumos">
                        <div style="display: flex; gap: 10px;">
                            <input type="text" name="mes" th:value="${periodo.mes}" required style="flex: 1;">
                            <input type="number" name="ano" th:value="${periodo.ano}" required style="flex: 1;">
                            <input type="number" step="0.01" name="consumo" th:value="${periodo.consumo}" required style="flex: 1;">
                            <input type="hidden" name="unidad" th:value="${periodo.unidad}">
                            <button type="button" class="btn btn-success" onclick="confirmarCambioConsumo(event)">Guardar Cambios</button>
                            <a th:href="@{/mis-consumos}" class="btn btn-danger">Cancelar</a>
                        </div>
                    </form>
                </td>
                
                <!-- Vista normal (no edici√≥n) -->
                <td th:if="${editarConsumoId != periodo.id}" th:text="${periodo.mes}">Mes</td>
                <td th:if="${editarConsumoId != periodo.id}" th:text="${periodo.ano}">A√±o</td>
                <td th:if="${editarConsumoId != periodo.id}" th:text="${periodo.consumo}">Consumo</td>
                <td th:if="${editarConsumoId != periodo.id}" th:text="${periodo.unidad}">Unidad</td>
                
                <!-- Botones de acci√≥n -->
                <td th:if="${editarConsumoId != periodo.id}">
                    <a th:href="@{/editar-consumo/{id}(id=${periodo.id})}" class="btn btn-primary">Editar</a>
                    <form th:action="@{/eliminar-consumo/{id}(id=${periodo.id})}" method="post" style="display:inline;" onsubmit="return confirmarEliminarConsumo()">
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </td>
            </tr>
            <tr th:if="${periodos.empty}">
                <td colspan="6" class="text-center">No hay registros de consumo</td>
            </tr>
        </tbody>
    </table>
</section>

<!-- Secci√≥n Mi Predio - A√±adir despu√©s de la secci√≥n de Mis Consumos -->
<section th:if="${section == 'mi-predio'}">
    <h4>Mi Predio</h4>
    <div class="alert alert-info">
        <p><strong>Nota:</strong> El registro de su predio es completamente opcional. Esta informaci√≥n nos ayuda a generar estad√≠sticas de consumo por zonas y ofrecer recomendaciones m√°s personalizadas.</p>
    </div>

    <!-- Mostrar mensaje de √©xito o error si existe -->
    <div th:if="${mensaje}" class="alert alert-success" th:text="${mensaje}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- Si no tiene predio registrado, mostrar formulario de registro -->
    <div th:if="${predio == null}" class="card">
        <div class="card-header">Registrar Predio</div>
        <div class="card-body">
            <form th:action="@{/predios/registrar}" method="post">
                <div class="mb-3">
                    <label for="direccion" class="form-label">Direcci√≥n</label>
                    <input type="text" class="form-control" id="direccion" name="direccion" required>
                </div>
                <div class="mb-3">
                    <label for="barrio" class="form-label">Barrio</label>
                    <input type="text" class="form-control" id="barrio" name="barrio" required>
                </div>
                <div class="mb-3">
                    <label for="estrato" class="form-label">Estrato</label>
                    <select class="form-control" id="estrato" name="estrato" required>
                        <option value="">Seleccione...</option>
                        <option value="1">Estrato 1</option>
                        <option value="2">Estrato 2</option>
                        <option value="3">Estrato 3</option>
                        <option value="4">Estrato 4</option>
                        <option value="5">Estrato 5</option>
                        <option value="6">Estrato 6</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="tipoPredio" class="form-label">Tipo de Predio</label>
                    <select class="form-control" id="tipoPredio" name="tipoPredio" required>
                        <option value="">Seleccione...</option>
                        <option th:each="tipo : ${tiposPredio}" th:value="${tipo}" th:text="${tipo}"></option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Registrar Predio</button>
            </form>
        </div>
    </div>

    <!-- Si ya tiene predio registrado, mostrar informaci√≥n y opciones de edici√≥n/eliminaci√≥n -->
    <div th:if="${predio != null}" class="card">
        <div class="card-header">Informaci√≥n de mi Predio</div>
        <div class="card-body">
            <!-- Si est√° en modo edici√≥n -->
            <form th:if="${editarPredio}" th:action="@{/predios/actualizar}" method="post">
                <input type="hidden" name="id" th:value="${predio.id}">
                <div class="mb-3">
                    <label for="direccion" class="form-label">Direcci√≥n</label>
                    <input type="text" class="form-control" id="direccion" name="direccion" 
                           th:value="${predio.direccion}" required>
                </div>
                <div class="mb-3">
                    <label for="barrio" class="form-label">Barrio</label>
                    <input type="text" class="form-control" id="barrio" name="barrio" 
                           th:value="${predio.barrio}" required>
                </div>
                <div class="mb-3">
                    <label for="estrato" class="form-label">Estrato</label>
                    <select class="form-control" id="estrato" name="estrato" required>
                        <option value="">Seleccione...</option>
                        <option value="1" th:selected="${predio.estrato == 1}">Estrato 1</option>
                        <option value="2" th:selected="${predio.estrato == 2}">Estrato 2</option>
                        <option value="3" th:selected="${predio.estrato == 3}">Estrato 3</option>
                        <option value="4" th:selected="${predio.estrato == 4}">Estrato 4</option>
                        <option value="5" th:selected="${predio.estrato == 5}">Estrato 5</option>
                        <option value="6" th:selected="${predio.estrato == 6}">Estrato 6</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="tipoPredio" class="form-label">Tipo de Predio</label>
                    <select class="form-control" id="tipoPredio" name="tipoPredio" required>
                        <option th:each="tipo : ${tiposPredio}" 
                                th:value="${tipo}" 
                                th:text="${tipo}"
                                th:selected="${predio.tipoPredio == tipo}"></option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Guardar Cambios</button>
                <a th:href="@{/mi-predio}" class="btn btn-secondary">Cancelar</a>
            </form>
            
            <!-- Si no est√° en modo edici√≥n, mostrar datos -->
            <div th:unless="${editarPredio}" class="table-responsive">
                <table class="table table-bordered">
                    <tr>
                        <th style="width: 30%">Direcci√≥n</th>
                        <td th:text="${predio.direccion}">Calle 123</td>
                    </tr>
                    <tr>
                        <th>Barrio</th>
                        <td th:text="${predio.barrio}">Centro</td>
                    </tr>
                    <tr>
                        <th>Estrato</th>
                        <td th:text="${predio.estrato}">3</td>
                    </tr>
                    <tr>
                        <th>Tipo de Predio</th>
                        <td th:text="${predio.tipoPredio}">CASA</td>
                    </tr>
                </table>
                
                <div class="mt-3">
                    <a th:href="@{/predios/editar}" class="btn btn-primary">Editar Predio</a>
                    <form th:action="@{/predios/eliminar}" method="post" style="display:inline;">
                        <button type="submit" class="btn btn-danger" 
                                onclick="return confirm('¬øEst√° seguro de eliminar este predio? Esta acci√≥n no se puede deshacer.')">
                            Eliminar Predio
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

            </div>
        </div>
    </div>




        <!-- Pie de p√°gina -->
     <footer>
         <div class="contenido-pie-pagina">
             <img src="/img_local/logo-pagina-serviapp.png" alt="Logo" class="footer-logo">
             <span>¬© 2024 ServiApp / todos los derechos reservados</span>
             <ul class="enlaces-pie-pagina">
                 <li><a href="#" id="openModal-privacidad">Privacidad</a></li>
               
             </ul>
         </div>
         <div class="nota-pie-pagina">
             <a href="">No compartir informaci√≥n</a>
         </div>
     </footer>
 
         <!-- ventana privacidasd -->
    <div id="termsModal-privacidad" class="modal-privacidad">
        <div class="modal-content-privacidad">
            <span class="cerrar-privacidad">&times;</span>
            <h2>PRIVACIDAD</h2>
                <p>
            En ServiApp somos conscientes de la importancia de la privacidad y protecci√≥n de los datos personales de nuestros usuarios. Por esta raz√≥n, nuestro deber con la seguridad de la informaci√≥n de nuestros usuarios est√° fundamentado en este marco legal que respalda todos nuestros procesos.<br><br>
            
            Las normas internacionales ofrecen un marco general para el tratamiento adecuado de la informaci√≥n de los usuarios. Aunque estas normativas no siempre tienen aplicaci√≥n directa en Colombia, representan normativas que en ServiApp tratamos de cumplir para proteger la privacidad de nuestros usuarios. El convenio 108 del Consejo de Europa, por ejemplo, es una referencia clave que establece principios b√°sicos sobre la protecci√≥n de los datos personales frente a su tratamiento automatizado. El Reglamento General de Protecci√≥n de Datos (GDPR) de la Uni√≥n Europea es un referente mundial en t√©rminos de la protecci√≥n de la privacidad y, a pesar de que est√° dirigido a ciudadanos europeos, se puede considerar un modelo a seguir. De igual forma, los principios de los Derechos Humanos de las Naciones Unidas establecen la importancia de respetar la privacidad como un derecho humano.<br><br>
            
            En Colombia, el marco legal se consolida a partir de la Constituci√≥n Pol√≠tica Nacional, en la cual el art√≠culo 15 nos expone sobre el derecho a la intimidad y protecci√≥n de datos personales. En ServiApp, nos aseguramos de que nuestros usuarios puedan ejercer este derecho, permiti√©ndoles acceder y actualizar su informaci√≥n almacenada en nuestra base de datos cuando lo requieran. Tambi√©n nos basamos en el art√≠culo 20, el cual protege el derecho a recibir informaci√≥n clara y veraz. Para nosotros, esto significa que todo lo relacionado con el tratamiento de datos ser√° siempre transparente y comprensible.<br><br>
            
            La Ley 1581 de 2012, conocida como la Ley de Protecci√≥n de Datos Personales, es la ley central de nuestra operaci√≥n en Colombia. Esta ley establece los principios y procedimientos que debemos seguir al manejar los datos de nuestros usuarios, asegurando su privacidad y estableciendo obligaciones claras para nosotros como responsables de esa informaci√≥n. De igual forma, seguiremos la Ley 1266 de 2008, que regula espec√≠ficamente el manejo de informaci√≥n financiera y crediticia, y la Ley 1273 de 2009, que tipifica los delitos inform√°ticos y define las sanciones aplicables para quienes accedan sin autorizaci√≥n a sistemas inform√°ticos, algo esencial para la seguridad de los datos que manejaremos en nuestra plataforma.<br><br>
            
            Adem√°s de estas leyes, ServiApp sigue las regulaciones emitidas a trav√©s de decretos. Por ejemplo, el Decreto 1377 de 2013 es importante, pues nos explica c√≥mo debemos obtener el consentimiento de nuestros usuarios para poder recolectar y usar sus datos. En cada registro debemos asegurarnos de que los usuarios tengan claro para qu√© fines se usar√° su informaci√≥n. Por otro lado, el Decreto 886 de 2014, que aborda temas de ciberseguridad, nos ayuda a implementar medidas de protecci√≥n adecuadas para evitar riesgos de seguridad.<br><br>
            
            Para las regulaciones a nivel local en la ciudad de Cartagena, cumplimos con los acuerdos municipales y ordenanzas locales que pueden influir en la manera en que gestionamos los servicios p√∫blicos y la informaci√≥n asociada.<br><br>
            
            El C√≥digo Penal Colombiano tambi√©n es importante, ya que establece sanciones para quienes cometan delitos inform√°ticos, como la violaci√≥n de la privacidad o el uso indebido de los datos personales. En ServiApp seguimos estos lineamientos para prevenir cualquier incidente que pudiera comprometer la seguridad de la informaci√≥n.<br><br>
            
            Finalmente, aplicamos lo que establecen las resoluciones y circulares emitidas por organismos de control. La Resoluci√≥n 002 de 2021 de la Superintendencia de Industria y Comercio (SIC) nos ofrece gu√≠as claras sobre c√≥mo gestionar los datos personales en nuestro contexto tecnol√≥gico, mientras que la Circular Externa 005 de 2017 nos orienta sobre c√≥mo manejar la informaci√≥n en sistemas digitales, garantizando que estemos al d√≠a con las mejores pr√°cticas.
                </p>
        </div>
        </div>
 
        <script src="/javascripts/barra_perfil.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
        <script src="/javascripts/ventana_privacidad.js"></script> 
        <script src="/javascripts/ventanas_perfil.js"></script> 





   
</body>

</html>
