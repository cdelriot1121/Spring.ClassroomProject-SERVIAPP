<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ServiApp</title>
    
    <!--Parte Header compartida desde aqui....-->
    <link rel="shortcut icon" href="/img_local/logo-pagina-serviapp.png" />

    <!--links CSS-->
    <link rel="stylesheet" href="/estilos_interfaz-usuario/barra_perfil.css"> 
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/estilos_interfaz-usuario/style_consejos_pers.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
      <!-- DataTables CSS y JS -->
      <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>


    <!--BOXICOINS Y BOOTSTRAP-->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


    <!--Fuente Kanit-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>

<body>
    <header>
        <div class="header-left">
          <button class="toggle-btn" onclick="toggleSidebar()">
            <i class="bi bi-list"></i>
          </button>
          <div class="header-logo">
            <h1 class="header-title">ServiApp</h1>
            <div class="mensaje_bienvenida" id="mensajeBienvenida">
              <p th:if="${nombreUsuario}" th:text="'Hola, ' + ${nombreUsuario} + '!'"></p>
            </div>
          </div>
        </div>
    
        <div class="profile-menu">
          <button class="profile-button" id="profileButton">
            <img src="https://img.freepik.com/vector-premium/icono-perfil-usuario-estilo-plano-ilustracion-vector-avatar-miembro-sobre-fondo-aislado-concepto-negocio-signo-permiso-humano_157943-15752.jpg" alt="Avatar" class="profile-avatar">
          </button>
          <div class="profile-dropdown" id="profileDropdown">
            <a href="datos-personales"><i class="bi bi-gear"></i> Configuración</a>
            <a href="/"><i class="bi bi-box-arrow-right"></i> Cerrar Sesión</a>
          </div>
        </div>
      </header>
    
      <!-- Sidebar -->
      <div class="sidebar" id="sidebar">
        <a href="interfaz_inicio" class="active"><i class="bi bi-house-door-fill"></i> Inicio</a>
        <a href="registrar_servicio"><i class="bi bi-check-square"></i> Registrar Servicio</a>
        <a href="gestionar-servicio"><i class="bi bi-bar-chart-line"></i> Gestionar Servicio</a>
        <a href="consejos-personzalidos"><i class="bi bi-lightbulb"></i> Consejos de Ahorro</a>
        <a href="cortes"><i class="bi bi-clock-history"></i> Cortes</a>
        <a href="lineas-atencion"><i class="bi bi-telephone-forward"></i> Líneas de Atención</a>
      </div>
    
      <div class="consejos">

      <h1>Tus Consejos De Ahorro Personalizados</h1>
      
      <h3>Estos son tus consejos obtenidos a la fecha acorde 
        <br>con el comportamiento de tus consumos en lo 
        <br>diverosos servicios publicos</h3>
    </div>

    <div class="container mt-4" style="max-width: 1000px;">
        <div class="row justify-content-center">
            <div class="col-md-12">
                <div class="card" style="background-color: #f8f9fa;">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Consejos Personalizados</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-3 mb-3">
                            <div>
                                <label for="filtroMes">Filtrar por Mes:</label>
                                <select id="filtroMes" class="form-select">
                                    <option value="">Seleccionar mes</option>
                                </select>
                            </div>
    
                            <div>
                                <label for="filtroAnio">Filtrar por Año:</label>
                                <select id="filtroAnio" class="form-select">
                                    <option value="">Seleccionar año</option>
                                </select>
                            </div>
    
                            <div>
                                <label for="filtroServicio">Filtrar por Servicio:</label>
                                <select id="filtroServicio" class="form-select">
                                    <option value="">Seleccionar servicio</option>
                                </select>
                            </div>
                        </div>
    
                        <div class="table-responsive">
                            <table id="tablaConsejos" class="tabla-consejos-personalizados table table-hover table-striped table-bordered mx-auto">
                                <thead class="table-primary text-center">
                                    <tr>
                                        <th>Servicio</th>  
                                        <th>Mes</th>        
                                        <th>Año</th>        
                                        <th>Consumo</th>    
                                        <th>Unidad</th>
                                        <th>Consejo</th>    
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="periodo : ${periodos}">
                                        <td th:text="${periodo.servicio.tipo_servicio}"></td>
                                        <td th:text="${periodo.mes}"></td>
                                        <td th:text="${periodo.ano}"></td>
                                        <td th:text="${periodo.consumo}"></td>
                                        <td th:text="${periodo.unidad}">Unidad</td>
                                        <td class="buton-con">
                                            <button class="btn btn-info custom-button" onclick="toggleConsejos(this)">
                                                Ver Consejos
                                            </button>
                                            <ul class="lista-consejos" style="display: none;">
                                                <li th:each="consejo : ${periodo.consejos}" th:text="${consejo.contenido}"></li>
                                            </ul>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
    
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    
    <script>
        function toggleConsejos(button) {
            const lista = button.nextElementSibling;
            lista.style.display = lista.style.display === "block" ? "none" : "block";
        }
    
        $(document).ready(function () {
            const tabla = $('#tablaConsejos').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                },
                initComplete: function () {
                    const api = this.api();
                    const columnaMes = api.column(1); 
                    const columnaAno = api.column(2); 
                    const columnaServicio = api.column(0); 
    
                    let meses = new Set();
                    let anos = new Set();
                    let servicios = new Set();
    
                    // Recolecta valores únicos
                    api.rows().every(function () {
                        const data = this.data();
                        meses.add(data[1]); // Mes
                        anos.add(data[2]); // Año
                        servicios.add(data[0]); // Servicio
                    });
    
                    // Llenar select de Mes
                    meses = Array.from(meses).sort();
                    meses.forEach(m => {
                        $('#filtroMes').append(`<option value="${m}">${m}</option>`);
                    });
    
                    // Llenar select de Año
                    anos = Array.from(anos).sort();
                    anos.forEach(a => {
                        $('#filtroAnio').append(`<option value="${a}">${a}</option>`);
                    });
    
                    // Llenar select de Servicios
                    servicios = Array.from(servicios).sort();
                    servicios.forEach(s => {
                        $('#filtroServicio').append(`<option value="${s}">${s}</option>`);
                    });
    
                    // Función para aplicar filtros
                    function filtrarPorMesAnoYServicio() {
                        const mes = $('#filtroMes').val();
                        const ano = $('#filtroAnio').val();
                        const servicio = $('#filtroServicio').val();
    
                        let regex = "";
                        if (mes) {
                            regex += `^${mes} `;
                        }
                        if (ano) {
                            regex += `${ano} `;
                        }
                        if (servicio) {
                            regex = regex ? regex + servicio : servicio;
                        }
    
                        // Aplica el filtro
                        api.columns([1, 3, 0]).every(function () {
                            const column = this;
                            column.search(regex, true, false).draw();
                        });
                    }
    
                    // Aplicar filtro cuando el usuario cambia alguna opción
                    $('#filtroMes, #filtroAnio, #filtroServicio').on('change', filtrarPorMesAnoYServicio);
                }
            });
        });

        
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const content = document.getElementById('content');
      const footer = document.querySelector('footer');
      
      sidebar.classList.toggle('open');
      content.classList.toggle('sidebar-open');
      footer.classList.toggle('sidebar-open');
    }

    // Profile dropdown functionality
    document.addEventListener('DOMContentLoaded', function() {
      const profileButton = document.getElementById('profileButton');
      const profileDropdown = document.getElementById('profileDropdown');
      
      if (profileButton && profileDropdown) {
        profileButton.addEventListener('click', function() {
          profileDropdown.style.display = profileDropdown.style.display === 'block' ? 'none' : 'block';
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
          if (!profileButton.contains(event.target) && !profileDropdown.contains(event.target)) {
            profileDropdown.style.display = 'none';
          }
        });
      }

      // Modal functionality
      const modal = document.getElementById('mapModal');
      const closeBtn = document.querySelector('.close');
      
      if (closeBtn) {
        closeBtn.onclick = function() {
          modal.style.display = 'none';
        }
      }
      
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = 'none';
        }
      }
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(event) {
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.querySelector('.toggle-btn');
        
        if (window.innerWidth <= 768 && sidebar && toggleBtn && 
            !sidebar.contains(event.target) && 
            !toggleBtn.contains(event.target) && 
            sidebar.classList.contains('open')) {
          toggleSidebar();
        }
      });

      // Map buttons functionality (example for Afinia)
      const btnAfinia = document.getElementById('btnAfinia');
      if (btnAfinia) {
        btnAfinia.addEventListener('click', function() {
          const mapFrame = document.getElementById('mapFrame');
          mapFrame.src = "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3916.123456789!2d-75.123456789!3d10.123456789!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMTDCsDA3JzI0LjQiTiA3NcKwMDcnMjQuNCJX!5e0!3m2!1sen!2sco!4v1234567890";
          document.getElementById('mapModal').style.display = 'block';
        });
      }

      // Add similar event listeners for btnAguas and btnSurtigas
    });
  </script>
    


     <!-- Pie de página -->
     <footer>
        <div class="contenido-pie-pagina">
            <img src="/img_local/logo-pagina-serviapp.png" alt="Logo" class="footer-logo">
            <span>© 2024 ServiApp / todos los derechos reservados</span>
            <ul class="enlaces-pie-pagina">
                <li><a href="#" id="openModal-privacidad">Privacidad</a></li>
              
            </ul>
        </div>
        <div class="nota-pie-pagina">
            <a href="">No compartir información</a>
        </div>
    </footer>

        <!-- ventana privacidasd -->
        <div id="termsModal-privacidad" class="modal-privacidad">
            <div class="modal-content-privacidad">
                <span class="cerrar-privacidad">&times;</span>
                <h2>PRIVACIDAD</h2>
                    <p>
                En ServiApp somos conscientes de la importancia de la privacidad y protección de los datos personales de nuestros usuarios. Por esta razón, nuestro deber con la seguridad de la información de nuestros usuarios está fundamentado en este marco legal que respalda todos nuestros procesos.<br><br>
                
                Las normas internacionales ofrecen un marco general para el tratamiento adecuado de la información de los usuarios. Aunque estas normativas no siempre tienen aplicación directa en Colombia, representan normativas que en ServiApp tratamos de cumplir para proteger la privacidad de nuestros usuarios. El convenio 108 del Consejo de Europa, por ejemplo, es una referencia clave que establece principios básicos sobre la protección de los datos personales frente a su tratamiento automatizado. El Reglamento General de Protección de Datos (GDPR) de la Unión Europea es un referente mundial en términos de la protección de la privacidad y, a pesar de que está dirigido a ciudadanos europeos, se puede considerar un modelo a seguir. De igual forma, los principios de los Derechos Humanos de las Naciones Unidas establecen la importancia de respetar la privacidad como un derecho humano.<br><br>
                
                En Colombia, el marco legal se consolida a partir de la Constitución Política Nacional, en la cual el artículo 15 nos expone sobre el derecho a la intimidad y protección de datos personales. En ServiApp, nos aseguramos de que nuestros usuarios puedan ejercer este derecho, permitiéndoles acceder y actualizar su información almacenada en nuestra base de datos cuando lo requieran. También nos basamos en el artículo 20, el cual protege el derecho a recibir información clara y veraz. Para nosotros, esto significa que todo lo relacionado con el tratamiento de datos será siempre transparente y comprensible.<br><br>
                
                La Ley 1581 de 2012, conocida como la Ley de Protección de Datos Personales, es la ley central de nuestra operación en Colombia. Esta ley establece los principios y procedimientos que debemos seguir al manejar los datos de nuestros usuarios, asegurando su privacidad y estableciendo obligaciones claras para nosotros como responsables de esa información. De igual forma, seguiremos la Ley 1266 de 2008, que regula específicamente el manejo de información financiera y crediticia, y la Ley 1273 de 2009, que tipifica los delitos informáticos y define las sanciones aplicables para quienes accedan sin autorización a sistemas informáticos, algo esencial para la seguridad de los datos que manejaremos en nuestra plataforma.<br><br>
                
                Además de estas leyes, ServiApp sigue las regulaciones emitidas a través de decretos. Por ejemplo, el Decreto 1377 de 2013 es importante, pues nos explica cómo debemos obtener el consentimiento de nuestros usuarios para poder recolectar y usar sus datos. En cada registro debemos asegurarnos de que los usuarios tengan claro para qué fines se usará su información. Por otro lado, el Decreto 886 de 2014, que aborda temas de ciberseguridad, nos ayuda a implementar medidas de protección adecuadas para evitar riesgos de seguridad.<br><br>
                
                Para las regulaciones a nivel local en la ciudad de Cartagena, cumplimos con los acuerdos municipales y ordenanzas locales que pueden influir en la manera en que gestionamos los servicios públicos y la información asociada.<br><br>
                
                El Código Penal Colombiano también es importante, ya que establece sanciones para quienes cometan delitos informáticos, como la violación de la privacidad o el uso indebido de los datos personales. En ServiApp seguimos estos lineamientos para prevenir cualquier incidente que pudiera comprometer la seguridad de la información.<br><br>
                
                Finalmente, aplicamos lo que establecen las resoluciones y circulares emitidas por organismos de control. La Resolución 002 de 2021 de la Superintendencia de Industria y Comercio (SIC) nos ofrece guías claras sobre cómo gestionar los datos personales en nuestro contexto tecnológico, mientras que la Circular Externa 005 de 2017 nos orienta sobre cómo manejar la información en sistemas digitales, garantizando que estemos al día con las mejores prácticas.
                    </p>
            </div>
        </div> 


    <script src="/javascripts/barra_perfil.js"></script>
    <script src="/javascripts/ventana_privacidad.js"></script> 
    <script src="/javascripts/consejo_personal.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <style>
    /* Ajuste para el contenedor de la tabla */
    .tabla-consejos-personalizados {
        margin-top: 1rem;
        width: 100% !important;
        border-collapse: separate;
        border-spacing: 0 10px;
    }
    
    /* Cabecera de la tabla */
    .tabla-consejos-personalizados thead th {
        background-color: #007ccf;
        color: white;
        font-weight: bold;
        text-align: center;
        padding: 12px 15px;
        font-size: 14px;
        border-radius: 8px 8px 0 0;
    }
    
    /* Celdas del cuerpo de la tabla */
    .tabla-consejos-personalizados tbody td {
        background-color: #ffffff;
        color: #333;
        text-align: center;
        padding: 10px 15px;
        font-size: 14px;
        vertical-align: middle;
        border-radius: 8px;
    }
    
    /* Hover sobre filas */
    .tabla-consejos-personalizados tbody tr:hover {
        background-color: #f7f7f7;
        transform: translateY(-2px);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    
    /* Bordes de las celdas */
    .tabla-consejos-personalizados td,
    .tabla-consejos-personalizados th {
        border: 1px solid #ddd;
        border-radius: 5px;
    }
    
    /* Estilo para el filtro de búsqueda de DataTables */
    .dataTables_filter input {
        border-radius: 5px;
        border: 1px solid #ddd;
        padding: 8px 12px;
        margin-left: 10px;
        font-size: 14px;
        width: 250px;
    }
</style>
    
</body>
</html>